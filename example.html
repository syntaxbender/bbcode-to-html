<div style="display: block;margin:30px;" id="output">
</div>
<textarea id="textbox" style="width:220px;height:150px;" placeholder="Test edilmek üzere b,code,img taglarını içeren bir test stringi gir."></textarea>
<input type="button" onclick="start();" value="test et" style="display: block;">
<script type="text/javascript">
	function start(){
		var text = document.getElementById("textbox").value;
		GGCodeParser(text);
	}
	function GGCodeParseError(text){
		alert(text);
	}
	function bold_func(text,opentag,closetag){
		text[opentag] = "<b>";
		text[closetag] = "</b>";
		return text;
	}
	function h1_func(text,opentag,closetag){
		text[opentag] = "<h1>";
		text[closetag] = "</h1>";
		return text;
	}
	function h2_func(text,opentag,closetag){
		text[opentag] = "<h2>";
		text[closetag] = "</h2>";
		return text;
	}
	function h3_func(text,opentag,closetag){
		text[opentag] = "<h3>";
		text[closetag] = "</h3>";
		return text;
	}
	function highlight_func(text,opentag,closetag,parameter){
		if(parameter == "") parameter="yellow";
		text[opentag] = "<span style=\"background:"+parameter+";\">";
		text[closetag] = "</span>";
		return text;
	}
	function color_func(text,opentag,closetag,parameter){
		if(parameter == "") GGCodeParseError("11");
		text[opentag] = "<span style=\"color:"+parameter+";\">";
		text[closetag] = "</span>";
		return text;
	}
	function underline_func(text,opentag,closetag){
		text[opentag] = "<span style=\"text-decoration:underline;\">";
		text[closetag] = "</span>";
		return text;
	}
	function code_func(text,opentag, closetag,parameter){
		text[opentag] = "<pre><code class=\""+parameter+"\">";
		text[closetag] = "</code></pre>";
		return text;
	}
	function quote_func(text,opentag, closetag,parameter){
		if(parameter != "") var author = "<p>"+parameter+"</p>";
		else var author = "";
		text[opentag] = "<blockquote>";
		text[closetag] = author+"</blockquote>";
		return text;
	}
	function img_func(text,opentag,closetag){
		text[opentag] = "<img src=\"";
		text[closetag] = "\"/>";
		return text;
	}
	function ul_func(text,opentag,closetag){
		text[opentag] = "<ul>";
		text[closetag] = "</ul>";
		return text;
	}
	function li_func(text,opentag,closetag){
		text[opentag] = "<li>";
		text[closetag] = "</li>";
		return text;
	}
	function GGCodeParser(text){
		var text_array = [];
		var total = text.length;
		var tag_checker = [];
		var tag_placements = [];
		var tagarray = {
			"b":["bold_func","noparameter"],
			"color":["color_func","withparameter"],
			"u":["underline_func","noparameter"],
			"h1":["h1_func","noparameter"],
			"h2":["h2_func","noparameter"],
			"h3":["h3_func","noparameter"],
			"highlight":["highlight_func"],
			"code":["code_func","withparameter"],
			"img":["img_func","noparameter"],
			"quote":["quote_func","withparameter"],
			"ul":["ul_func","noparameter"],
			"li":["li_func","noparameter"],
		};
		var buffer = "";
		for(var start=0;start<text.length;start++){
			if(text[start] == "]"){
				if(buffer.includes("=")){
					buffer = buffer.split("=");
					var parameter = buffer[1];
					buffer = buffer[0];
				}else{
					var parameter = "";
				}
				if(tagarray[buffer] != null){
					if(parameter != "" && tagarray[buffer][1] != "withparameter"){
						GGCodeParseError(11);
						return;
					} 
					tag_checker.push([buffer,tag_placements.length]);
					tag_placements.push([buffer,parameter,text_array.length]);
					text_array.push(buffer);
				}else if(tagarray[buffer.substr(1, buffer.length)] != null && buffer.substr(0, 1) == "/") {
					if(parameter != ""){
						GGCodeParseError(11);
						return;
					}
					if(tag_checker[(tag_checker.length-1)][0] == buffer.substr(1, buffer.length)){
						tag_placements[tag_checker[(tag_checker.length-1)][1]].push(text_array.length);
						text_array.push(buffer);
						tag_checker.splice((tag_checker.length-1), 1);
					}else{
						GGCodeParseError(11);
						return;
					}
				}else{
					text_array.push("["+buffer+"]");
				}
				buffer = "";
			}else if(text[start] == "["){
				if(buffer != null && buffer != "" && buffer.length != 0){
					text_array.push(buffer);
				}
				buffer = "";
			}else{
				if(text[start] == "\n") buffer += "<br>";
				else
				buffer += text[start];
			}
		}
		if(tag_checker.length != 0){
			GGCodeParseError(22);
			return;
		}
		var fixed_text = text_array;
		for(var i in tag_placements){
			if(tagarray[tag_placements[i][0]][1] == "withparameter"){
				fixed_text = window[tagarray[tag_placements[i][0]][0]](fixed_text,tag_placements[i][2],tag_placements[i][3],tag_placements[i][1]);
			}else{
				console.log(tag_placements[i][0]);
				fixed_text = window[tagarray[tag_placements[i][0]][0]](fixed_text,tag_placements[i][2],tag_placements[i][3]);
			}
		}
		var output = fixed_text.join('');
		document.getElementById("output").innerHTML = output;
	}
</script> 
